# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Модель состояние приложения

```
export interface IAppState {
	cardList: ICard[];
	basket: string[];
	order: IOrder;
	preview: string;
	formErrors: FormErrors;
}
```

Главная страница

```
export interface IPage {
	cardList: HTMLElement[];
}
```

Интерфейс карточки

```
export interface ICard {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Интерфейс формы заказа

```
export interface IOrderForm {
	payment?: string;
	address?: string;
	phone?: string;
	email?: string;
	total?: number | string;
}
```

Интерфейс заказа

```
export interface IOrder extends IOrderForm {
	items: string[];
}
```

Интерфейс в случае удачного оформления 

```
export interface ISuccessForm {
	id: string;
	total: number;
}
```

Интерфейс валидации формы

```
export interface IFormValid {
	valid: boolean;
	errors: string[];
}
```

Тип ошибки формы

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Интерфейс корзины

```
export interface IBasket {
	items: HTMLElement[];
	total: number;
}
```

Api ответ с сервера для списка обьектов

```
export type ApiListResponse<Type> = {
	total: number;
	items: Type[];
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cards: changed` - изменение массива карточек
- `card: selected` - изменение открываемой в модальном окне картинки карточки

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card: select` - выбор карточки для отображение в модальном окне


### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает обьект с данными, которые будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс ApiModel
Наследник класса Api.\
Поля класса:
- `cdn(string)` - Базовый URL адрес

Методы класса:
- `getCardList()` - получаем список всех карточек с сервера
- `getCardItem()` - получаем данные карточки по id
- `orderCard()` - возвращение данных по заказу

#### Класс Component
Абстрактный базовый класс, для взаимодействия с DOM элементами. В дальнейшем от него будут наследоваться классы отображения:
- Page
- Card
- Basket
- Modal
- Form
- ISuccessForm

Методы:
- `toggleClass()` - переключает классы.
- `setText()` - устанавливает текстовое поле.
- `setDisabled()` - меняет статус блокировки.
- `setHidden()` - скрывает элемент.
- `setVisible()` - показывает элемент.
- `setImage()` - устанавливает изображение с альтернативным текстом.
- `render()` - возвращает корневой DOM элемент.


### Слой данных

#### Класс AppState 
Класс управления состоянием приложения. Включает в себя список карточек, заказы, формы, корзину.\
Поля класса:
- `cardList: ICard[]`
- `basket: string[]`
- `order: IOrder`
- `preview: string`
- `formErrors: FormErrors`

Методы:
 - `setCatalog` - устанавливает список карточек.
 - `setPreview` - устанавливает предпросмотр карточек.
 - `addCardToBasket` - добавляет товар в заказ.
 - `setCardToBasket` - добавляет товар в корзину.
 - `basketList` - вернуть список товара в корзине.
 - `statusBasket` - вернуть информацию по составу в корзине.
 - `total` - вывести сумму заказа.
 - `getTotal` - вернуть общую сумму заказов.
 - `deleteCardToBasket` - удалить товар из корзины.
 - `setOrderField` - Вывести данные введенные в поле доставки.
 - `setContactsField` - Вывести данные введенные в поле контакты.
 - `validateOrder` - Валидация введенных данных.
 - `validateContacts` - Валидация введенных формы контактов.
 - `clearOrder` - отчистка заказа.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Basket 
Управляет отображением корзины.\
Поля класса: 
- `list: HTMLElement` - список товаров
- `button: HTMLButtonElement` - кнопка удаления
- `total: HTMLElement` - цена общая

Методы:
- `set items()` - вставить данные в корзину
- `set total()` - посчитать общую стоимость товара

#### Класс Form
Класс для работы с формами.\
Поля класса:
- `submit` - HTMLButtonElement
- `errors` - HTMLElement 

Методы:
- `InputChange` - обработчик событий ввода.
- `set valid` - контролирует активность кнопки отправки в зависимости от валидности формы.
- `set errors` - устанавливает и отображает ошибки валидации формы.
- `render` - показывает состояние формы.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна.\
Поля класса:
- `closeButton` - HTMLButtonElement
- `content` - HTMLElement

Методы: 
- `set content` - определяет контент показа в модальном окне.
- `open` - открывает модальное окно.
- `close` - закрывает модальное окно.
- `render` - рендерит модальное окно.

#### Класс Card
Описание карточки товара.\
Поля класса: 
- `category` - HTMLElement
- `title` - HTMLElement
- `image` - HTMLImageElement
- `price` - HTMLElement

Методы:
- `set category(value: string)` - принимает строку с сервера, устанавливает категорию.
- `set title(value: string)` - принимает строку с сервера, устанавливает заголовок.
- `set image(value: string)` - принимает строку с сервера, устанавливает изображение.
- `set price(value: number)` - принимает номер с сервера, устанавливает цену.


#### Класс Page
Формирование главной страницы.\
Поля класса:
- `counterBasket` - HTMLElement
- `cardList` - HTMLElement
- `wrapper` - HTMLImageElement
- `basket` - HTMLElement

Методы:
- `set counter(value: number)` - изменить счетчик товара в корзине на главной странице
- `set catalog(items: HTMLElement[])` - вывести список карточек
- `set locked(value: boolean)` - установка или снятие блока прокрутки страницы

#### Класс Contacts 
Отображение модального окна заполнения почты, телефона.\
Поля класса:
- `phone` - string
- `email`- string

Методы:
- `set phone` - ввод телефона.
- `set email` - ввод почты.

#### Класс Success
Отображение модального удачного заказа.\
Поля класса:
- `total` - number

Методы:
- `set total` - устанавливает текст в элемент. 

#### Класс Order
Отображение модальных окон заполнения адреса.\
Поля класса:
- `buttons` - HTMLButtonElement
- `address` - string

Методы класса:
- `set payment(name: string)` - переключение между кнопками.
- `set address` - ввод адреса доставки.

### Слой коммуникации 

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`: 
- `on` - подписка на событие
- `emit` - инициализация события 
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

